# Copyright: (c) 2019, Hetzner Cloud GmbH <info@hetzner-cloud.de>
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)
---
- name: test gather hcloud ssh key infos in check mode
  hetzner.hcloud.hcloud_ssh_key_info:
  register: hcloud_ssh_key
  check_mode: true
- name: verify test gather hcloud ssh key infos in check mode
  assert:
    that:
      - hcloud_ssh_key.hcloud_ssh_key_info| list | count >= 1

- name: test gather hcloud ssh key infos
  hetzner.hcloud.hcloud_ssh_key_info:
  register: hcloud_ssh_key
  check_mode: true
- name: verify test gather hcloud ssh key infos
  assert:
    that:
      - hcloud_ssh_key.hcloud_ssh_key_info| list | count >= 1

- name: test gather hcloud ssh key infos with correct label selector
  hetzner.hcloud.hcloud_ssh_key_info:
    label_selector: "key=value"
  register: hcloud_ssh_key
- name: verify test gather hcloud ssh key infos with correct label selector
  assert:
    that:
      - hcloud_ssh_key.hcloud_ssh_key_info|selectattr('name','equalto','{{ hcloud_ssh_key_name }}') | list | count == 1

- name: test gather hcloud ssh key infos with wrong label selector
  hetzner.hcloud.hcloud_ssh_key_info:
    label_selector: "key!=value"
  register: hcloud_ssh_key
- name: verify test gather hcloud ssh key infos with wrong label selector
  assert:
    that:
      - hcloud_ssh_key.hcloud_ssh_key_info | list | count == 0
